<%= render 'dashboard/shared/header' %>
<div class="container">
  <h1 class="form-h1">Neue Veranstaltung</h1>
  <div class="form-accordion event-accordion">
    <div id="accordion1" class="accordion-inner active">
      <div class="accordion-header">
        <span class="point">          
          <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
              <circle fill="currentColor" cx="10" cy="10" r="10"></circle>
              <text font-family="hero-new" font-size="14" font-weight="400" fill="#FFFFFF">
                  <tspan x="6.766" y="15">1</tspan>
              </text>
            </g>
          </svg>
        </span>
        <h2>Name, Location & Datum</h2>
      </div>
      <div class="accordion-body">
        <%= form_for(@event, :html => {role: "form", id: "form1", style: "overflow-x: hidden;"}, url: create_event1_path) do |f| %>
          <div class="form-group">
            <label for="eventname">Name</label>
            <input type="text" class="form-control" name="eventname" id="eventname" aria-describedby="eventHelp" placeholder="Eventname" required>
            <small id="eventHelp" class="form-text text-muted">Der Name der Ihrer Veranstaltung</small>
          </div>
          <div class="form-group">
            <label for="location">Location</label>
            <%= f.collection_select(:location_id, @user.locations.all, :id, :name, {}, {:class=>"form-control"}) %>
            <small id="locationHelp" class="form-text text-muted">Wählen Sie einen Veranstaltungsort aus.</small>
          </div>
          <label for="start_date">Startdatum</label>
          <div class="row" style="margin-bottom: 10px">
            <div class="col-8">
              <%= f.text_field :start_date, placeholder: '01.01.2019', 'data-type': 'date', class: "form-control date", readonly: 'true' %>
            </div>
            <div class="col-4">
              <%= f.time_field :start_time, placeholder: '12:00', 'data-type': 'time', class: "form-control", style: "text-align: center" %>
            </div>
          </div>
          <label for="start_date">Enddatum</label>
          <div class="row" style="margin-bottom: 10px">
            <div class="col-8">
              <%= f.text_field :end_date, placeholder: '01.01.2019', 'data-type': 'date', class: "form-control", readonly: 'true' %>
            </div>
            <div class="col-4">
              <%= f.time_field :end_time, placeholder: '12:00', 'data-type': 'time', class: "form-control", style: "text-align: center" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    <div id="accordion2" class="accordion-inner">
      <div class="accordion-header">
        <span class="point">          
          <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
              <circle fill="currentColor" cx="10" cy="10" r="10"></circle>
              <text font-family="hero-new" font-size="14" font-weight="400" fill="#FFFFFF">
                  <tspan x="6.766" y="15">2</tspan>
              </text>
            </g>
          </svg>
        </span>
        <h2>Bilder hochladen</h2>
      </div>
      <div class="accordion-body" id="imageupload">
        <div class="dropzone" id="myDropzone"></div>
      </div>
    </div>
    <div id="accordion3" class="accordion-inner">
      <div class="accordion-header">
        <span class="point">          
          <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
              <circle fill="currentColor" cx="10" cy="10" r="10"></circle>
              <text font-family="hero-new" font-size="14" font-weight="400" fill="#FFFFFF">
                  <tspan x="6.766" y="15">3</tspan>
              </text>
            </g>
          </svg>
        </span>
        <h2>Beschreibung & Performer</h2>
      </div>
      <div class="accordion-body">
        <form action="/performer/search" id="performer_search">
          <div class="form-group">
            <label for="Performer">Performer</label>
            <input type="text" class="form-control" name="q" id="performerSearch" placeholder="Performer">
            <div id="performerDropdown"></div>
          </div>
        </form>
        <%= form_for(Performer.new, :html => {role: "form", id: "invitePerformerForm", style: "display: none;"}, url: invite_performer_url) do |f| %>
          <h5>Performer einladen</h5>
          <div class="form-group input-group-sm">
            <%= f.text_field :name, placeholder: 'Name', class: "form-control" %>
          </div>
          <div class="form-group input-group-sm">
            <%= f.select(:category, Performer.categories, {}, {class: "form-control"}) %>
          </div>
          <div class="form-group input-group-sm">
            <%= f.email_field :email, placeholder: 'beispiel@email.de', class: "form-control" %>
          </div>
          <button type="submit" class="btn btn-primary">Performer einladen</button>
        <% end %>
        <%= form_for(Event.find(1), :html => {role: "form", id: "form3"}, url: create_event3_url(Event.find(1))) do |f| %>
          <div class="form-group">
            <label for="description">Beschreibung</label>
            <textarea class="form-control" id="description" aria-describedby="descriptionHelp" name="description" rows="3"></textarea>
            <small id="descriptionHelp" class="form-text text-muted">Tragen Sie hier weitere Informationen zu Ihrer Location ein</small>
          </div>
          <div class="form-group">
            <label for="category">Kategorie</label>
            <%= f.select(:category, Event.categories, {}, {class: "form-control"}) %>
            <small id="categoryHelp" class="form-text text-muted">Wählen Sie die nächstbeste Kategorie aus.</small>
          </div>
          <input type="text" class="form-control" name="performer_id" id="performer" hidden>
        <% end %>
        
    </div>
    </div>
    <div id="accordion4" class="accordion-inner">
      <div class="accordion-header">
        <span class="point">          
          <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
              <circle fill="currentColor" cx="10" cy="10" r="10"></circle>
              <text font-family="hero-new" font-size="14" font-weight="400" fill="#FFFFFF">
                  <tspan x="6.766" y="15">4</tspan>
              </text>
            </g>
          </svg>
        </span>
        <h2>Tickets</h2>
      </div>
      <div class="accordion-body">
        <div id="ticketContainer">
          <%= form_for(Ticket.new, :html => {role: "form", id: "newticket"}, url: create_ticket_path) do |f| %>
            <h5 style="margin-bottom: 10px !important;">Neues Ticket</h5>
            <input type="text" name="event_id" id="eventid" value="1" hidden>
            <input type="text" name="container" value="ticketContainer" hidden>
              <div class="input-group input-group-sm" style="margin-bottom: 5px;">
                <%= f.text_field :name, placeholder: 'Name', class: "form-control" %>
              </div>
              <div class="input-group input-group-sm" style="margin-bottom: 5px;">
                <%= f.select(:status, Ticket.stati, {}, {class: "form-control"}) %>
              </div>
              <div class="input-group input-group-sm" style="margin-bottom: 5px;">
                <%= f.number_field(:price, in: 0.00..10000.00, placeholder:'30,00', class:"form-control")%>
                <div class="input-group-append">
                  <span class="input-group-text" id="basic-addon2">€</span>
                </div>
              </div>
              <div class="input-group input-group-sm" style="margin-bottom: 5px;">
                <%= f.url_field :url, placeholder: 'Ticket Link', class: "form-control" %>
              </div>
              <div class="input-group">
                <%= f.submit "Ticket erstellen", class: "btn btn-primary" %>
              </div>
          <% end %>
          </div>
      </div>
    </div>
  </div>
  </div>
<div class="footer">
  <a href='' class="footer-link" id="button1">Weiter</a> 
  <a href='' class="footer-link" id="button2" style="display: none;">Weiter</a>
  <a href='' class="footer-link" id="button3" style="display: none;">Weiter</a>
  <a href='' class="footer-link" id="button4" style="display: none;">Weiter</a>
  <a href='/' class="footer-link" id="button5" style="display: none;">Fertigstellen</a>
</div>
<script>
  $(document).ready(function () {
    bsCustomFileInput.init()
  });
</script>
<script src="/jquery.timepicker.js"></script>
<script src="/modernizr.touch.js"></script>
<script>
  $( function() {
    $("*[data-type='date']").datepicker({
        language: 'de-DE',
        weekStart: 1,
        format: 'dd.mm.yyyy',
        daysShort: ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'],
        daysMin: ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'],
        months: ['Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'],
        monthsShort: ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez']
});
  });
</script>
<!-- Dropzone JS -->
<script src="https://unpkg.com/dropzone"></script>
<script src="https://unpkg.com/cropperjs"></script>
<script>
  var event_id = 0;
  Dropzone.options.myDropzone = {
 url: '/event/4/add_images',
 transformFile: function(file, done) {
  // Create Dropzone reference for use in confirm button click handler
  var myDropZone = this;
  // Create the image editor overlay
  var editor = document.createElement('div');
  editor.style.position = 'fixed';
  editor.style.left = 0;
  editor.style.right = 0;
  editor.style.top = 0;
  editor.style.bottom = 0;
  editor.style.zIndex = 9999;
  editor.style.backgroundColor = '#000';
  document.body.appendChild(editor);
  // Create confirm button at the top left of the viewport
  var buttonConfirm = document.createElement('button');
  buttonConfirm.className = 'btn btn-primary';
  buttonConfirm.style.position = 'absolute';
  buttonConfirm.style.right = '10px';
  buttonConfirm.style.top = '10px';
  buttonConfirm.style.zIndex = 9999;
  buttonConfirm.textContent = 'Confirm';
  editor.appendChild(buttonConfirm);
  buttonConfirm.addEventListener('click', function() {
    // Get the canvas with image data from Cropper.js
    var canvas = cropper.getCroppedCanvas({
      maxWidth: 1500,
      maxHeight: 880
    });
    // Turn the canvas into a Blob (file object without a name)
    canvas.toBlob(function(blob) {
      // Create a new Dropzone file thumbnail
      myDropZone.createThumbnail(
        blob,
        myDropZone.options.thumbnailWidth,
        myDropZone.options.thumbnailHeight,
        myDropZone.options.thumbnailMethod,
        false, 
        function(dataURL) {
          
          // Update the Dropzone file thumbnail
          myDropZone.emit('thumbnail', file, dataURL);
          // Return the file to Dropzone
          done(blob);
      });
    });
    // Remove the editor from the view
    document.body.removeChild(editor);
  });
  // Create an image node for Cropper.js
  var image = new Image();
  image.src = URL.createObjectURL(file);
  editor.appendChild(image);
  
  // Create Cropper.js
  var cropper = new Cropper(image, { aspectRatio: 1.7 });
},
    init: function() {
    this.on("processing", function(file) {
      this.options.url = 'event/' + event_id + '/add_images';
    });
  }
    
};
  
$('.dz-default').html('Dateien nach hier ziehen oder klicken zum hochladen');  
</script>
<!-- Step 1 -->
<script>
  $('#button1').on('click', function(event){
    event.preventDefault();
    $('#form1').submit();
 });
// Step 2  
 $('#button2').on('click', function(event){
    event.preventDefault();
    $('#form2').submit();
    $('#button2').remove();
    $('#button3').css('display', 'block');
    $("#accordion2").removeClass('active').addClass('done');
    $("#accordion3").addClass('active');
 });
// Step 3  
  $('#button3').on('click', function(event){
    event.preventDefault();
    $('#form3').submit();
    $('#button3').remove();
    $('#button4').css('display', 'block');
    $("#accordion3").removeClass('active').addClass('done');
    $("#accordion4").addClass('active');
 });
// Step 4    
  $('#button4').on('click', function(event){
    event.preventDefault();
    $('.container').html("<%= j(render 'shared/done') %>");
    $('#button4').remove();
    $('#button5').css('display', 'block');                            
 });
  
  $(document).ready(function() { 
            // bind 'myForm' and provide a simple callback function 
            $('#form1').ajaxForm();
            $('#form2').ajaxForm();
            $('#form3').ajaxForm();
            $('#invitePerformerForm').ajaxForm();
            $('#newticket').ajaxForm();
        });
</script>
<script>
$('#performer_search').on('keyup', function(event){
        event.preventDefault();
        if($('#performerSearch').val().length > 0){
          $.ajax({
                  type: 'GET',
                  url: 'performer/search',
                  data: $("#performer_search").serialize()
                });
        }
      });
$('#performer_search').focusout(function(event){
  if($('a' + ':hover').length) {
    return;
  };
  $('#performerDropdown').removeClass('active');
});
  
</script>
<script src="/jquery.form.min.js"></script>
<script>
 function changeAccordion(slide){
   $('.accordion-inner').removeClass('active');
   $('#accordion' + slide).addClass('active');
 };
</script>